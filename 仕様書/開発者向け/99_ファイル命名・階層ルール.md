# ファイル命名・階層ルール

本ドキュメントでは、nightwork_botプロジェクトにおけるファイル命名規則と階層構造のルールを定義します。

## 基本原則

1. **機能単位での分割**: 各機能は独立したディレクトリまたはファイルで管理
2. **役割の明確化**: ファイル名から役割が明確にわかるようにする
3. **一貫性の維持**: 同じ種類のファイルは同じ命名パターンを使用
4. **日本語の使用**: ユーザー向け機能名は日本語を使用（コマンド名など）

---

## 1. コマンドファイル (`src/commands/`)

### 命名規則
```
{番号}_{機能名}.js
```

### 番号体系
- **10番台**: 設定系コマンド
  - `10_設定.js` - メイン設定パネル
  - `11_設定経費.js` - 経費設定
  - `12_設定売上.js` - 売上設定
  - `13_設定KPI.js` - KPI設定
  - `14_設定出退勤.js` - 出退勤設定
  - `15_設定店内状況_ひっかけ一覧.js` - 店内状況設定
  - `16_設定接客ログ.js` - 接客ログ設定
  - `20_設定chat_gpt.js` - ChatGPT設定

- **90番台**: その他のコマンド
  - `90_メッセージ.js` - メッセージ送信
  - `91_メッセージファイル化.js` - メッセージアーカイブ
  - `97_ダイス.js` - ダイスロール
  - `98_設定くじ引き.js` - くじ引き設定
  - `99_設定level.js` - レベル設定

### ルール
- 番号は2桁で統一
- 機能名は日本語で記述
- 1ファイル = 1コマンド

---

## 2. ハンドラファイル (`src/handlers/`)

### 2.1 ルートハンドラ

#### 命名規則
```
{機能名}BotHandler.js
```

#### 例
- `keihiBotHandler.js` - 経費機能のエントリーポイント
- `syutBotHandler.js` - 出退勤機能のエントリーポイント
- `kuzibikiBotHandler.js` - くじ引き機能のエントリーポイント
- `tennai_hikkakeBotHandler.js` - 店内状況機能のエントリーポイント

#### 役割
- `interactionCreate.js`からのルーティングを受け取る
- customIdのプレフィックスで処理を振り分ける
- 詳細な処理は機能ディレクトリ内のファイルに委譲

### 2.2 機能ディレクトリ

#### 命名規則
```
{機能名}/
```

#### ディレクトリ構造パターン

**パターンA: 設定と実行で分割**
```
{機能名}/
├── index.js           # ルーター（setting/requestに振り分け）
├── setting/           # 設定パネル関連
│   ├── index.js      # 設定系ルーター
│   ├── panel.js      # パネル表示
│   ├── ids.js        # customId定義
│   └── ...
└── request/           # 申請・実行フロー
    ├── index.js      # 申請系ルーター
    ├── requestModal.js
    └── ...
```

**例**: `keihi/`, `uriage/`

**パターンB: 機能別ファイル**
```
{機能名}/
├── {機能名}Panel.js        # パネル表示
├── {機能名}Setup.js        # セットアップフロー
├── {機能名}Execute.js      # 実行処理
└── ...
```

**例**: `kuzibiki/`, `tennai_hikkake/`

**パターンC: サブ機能で分割**
```
syut/
├── syutHandler_Cast.js    # キャスト処理
├── syutHandler_Kuro.js    # 黒服処理
├── syutPanel_Cast.js      # キャストパネル
├── syutPanel_Kuro.js      # 黒服パネル
└── ...
```

### 2.3 ファイル命名パターン

#### パネル表示
```
{機能名}Panel.js
{機能名}Panel_{サブ機能}.js
```

**例**:
- `keihiPanel.js`
- `syutPanel_Cast.js`
- `tennaiPanel.js`

#### 設定・セットアップ
```
{機能名}Setup.js
{機能名}Config.js
```

**例**:
- `hikkakeSetup.js`
- `KPISetupHandler.js`

#### アクション処理
```
action_{アクション名}.js
{機能名}{アクション名}.js
```

**例**:
- `action_approve.js` - 承認処理
- `action_modify.js` - 修正処理
- `action_delete.js` - 削除処理

#### モーダル処理
```
{機能名}Modal.js
{対象}Modal.js
```

**例**:
- `requestModal.js`
- `syutAttendanceModal.js`

#### ルーター
```
index.js
{機能名}Router.js
```

**役割**: customIdに基づいて適切なハンドラに振り分ける

---

## 3. ユーティリティファイル (`src/utils/`)

### 3.1 設定管理

#### 命名規則
```
{機能名}ConfigManager.js
```

**例**:
- `keihiConfigManager.js`
- `syutConfigManager.js`

#### 役割
- GCSからの設定読み込み
- 設定の保存
- デフォルト値の提供

### 3.2 データストレージ

#### 命名規則
```
{機能名}Storage.js
gcs{機能名}.js
```

**例**:
- `kuzibikiStorage.js`
- `gcsTennaiHikkake.js`

#### 役割
- データの読み書き
- ファイルパスの管理

### 3.3 共通ユーティリティ

#### 命名規則
```
{機能}.js
```

**例**:
- `gcs.js` - GCS操作の共通関数
- `logger.js` - ログ出力
- `errorHandlers.js` - エラーハンドリング

---

## 4. CustomId命名規則

### 基本パターン
```
{機能プレフィックス}_{アクション}:{パラメータ1}:{パラメータ2}
```

### 機能プレフィックス
- `keihi_` - 経費
- `uriage_` - 売上
- `kpi:` - KPI（コロン区切り）
- `syut_` - 出退勤
- `cast_` - キャスト出退勤
- `kuro_` - 黒服出退勤
- `kuzibiki_` - くじ引き
- `hikkake_report_` - ひっかけ報告
- `config_` - 設定

### アクション例
- `_config` - 設定
- `_execute` - 実行
- `_register` - 登録
- `_approve` - 承認
- `_modify` - 修正
- `_delete` - 削除
- `_setup` - セットアップ
- `_report` - 報告

### パラメータ
コロン(`:`)で区切って追加情報を渡す

**例**:
```javascript
'keihi_request:btn:request:大阪店'
'cast_role_setup:大阪店'
'kpi:setup:channel'
'hikkake_report_modal_plan::大阪店'
```

---

## 5. ディレクトリ構造のベストプラクティス

### 5.1 機能が小規模な場合
単一のハンドラファイルで完結させる

```
handlers/
└── kuzibikiBotHandler.js
```

### 5.2 機能が中規模な場合
機能ディレクトリを作成し、役割ごとにファイル分割

```
handlers/
└── kuzibiki/
    ├── kuzibikiPanel.js
    ├── kuzibikiPanelHandler.js
    └── kuzibikiExecute.js
```

### 5.3 機能が大規模な場合
サブディレクトリで役割を分類

```
handlers/
└── keihi/
    ├── index.js
    ├── setting/
    │   ├── index.js
    │   ├── panel.js
    │   └── ...
    └── request/
        ├── index.js
        ├── requestModal.js
        └── ...
```

---

## 6. データファイル命名規則

### 6.1 設定ファイル
```
config.json
```

全ての機能で統一

### 6.2 データファイル
```
{年月日}.json
{年月}.json
{年}.json
{年月日}.csv
```

**例**:
- `20260106.json`
- `202601.json`
- `2026.json`

### 6.3 機能固有ファイル
```
店舗_役職_ロール.json
店内状況.json
ひっかけ一覧.json
接客ログ.json
```

---

## 7. インポート・エクスポート規則

### 7.1 名前付きエクスポート（推奨）
```javascript
// handlers/keihi/setting/panel.js
async function refreshKeihiSettingPanelMessage(guild, storeKey) {
  // ...
}

module.exports = {
  refreshKeihiSettingPanelMessage,
};
```

### 7.2 デフォルトエクスポート
```javascript
// handlers/kuzibikiBotHandler.js
async function kuzibikiBotHandler(interaction) {
  // ...
}

module.exports = kuzibikiBotHandler;
```

### 7.3 インポート
```javascript
// 名前付きインポート
const { refreshKeihiSettingPanelMessage } = require('./setting/panel');

// デフォルトインポート
const kuzibikiBotHandler = require('../handlers/kuzibikiBotHandler');
```

---

## 8. チェックリスト

新しい機能を追加する際は、以下を確認してください:

- [ ] コマンドファイルは適切な番号で命名されているか
- [ ] ハンドラファイル名は `{機能名}BotHandler.js` パターンに従っているか
- [ ] CustomIdは機能プレフィックスで始まっているか
- [ ] 機能が複雑な場合、適切にディレクトリ分割されているか
- [ ] ユーティリティファイルは `utils/{機能名}/` に配置されているか
- [ ] 設定管理は `{機能名}ConfigManager.js` で統一されているか
- [ ] `interactionCreate.js` にルーティングが追加されているか
- [ ] データ保存パスは仕様書の `データ保存.md` に従っているか

---

## 9. 参考資料

- [98_ファイル階層.md](./98_ファイル階層.md) - プロジェクト全体のファイル階層
- [データ保存.md](../データ保存.md) - データ保存構造の詳細
- [設定パネル.md](./設定パネル.md) - 設定パネルの実装ガイド
